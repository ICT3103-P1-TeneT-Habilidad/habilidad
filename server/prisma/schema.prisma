generator client {
   provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
  previewFeatures = ["transactionApi"]
}

datasource db {
  provider = "mysql"
  url = env("DATABASE_URL")
}

model User {
  userId   String  @id @default(uuid())
  username String @unique
  password String
  name String
  email String
  phoneNumber Int
  deactivationDate DateTime?
  createdOn DateTime @default(now())
  updatedOn DateTime @updatedAt
  role Role
  student Student?
  instructor Instructor?
  moderator Moderator?
  rToken RefreshTokens[]
  oToken OtpToken?
  eToken EmailToken?
  @@unique([email, phoneNumber])
}

model Student{
  studentId String @id @default(uuid())
  user   User @relation(fields: [userId], references: [userId])
  userId String
  transaction Transaction[]
  @@unique([userId])
}

model Instructor{
  instructorId String @id @default(uuid())
  user User @relation(fields: [userId], references: [userId])
  userId String
  course Course[]
  @@unique([userId])
}

model Moderator{
  moderatorId String @id @default(uuid())
  user User @relation(fields: [userId], references: [userId])
  userId String
  @@unique([userId])
}

model Course{
  courseId String @id @default(uuid()) 
  courseName String
  imageUrl String
  duration Int
  price Float
  description String
  language Language
  status Status
  approvalStatus Status
  createdOn DateTime @default(now())
  updatedOn DateTime @updatedAt
  instructor Instructor @relation(fields: [instructorId], references: [instructorId])
  instructorId String
  courseMaterial CourseMaterial[]
  transactions Transaction[]
  topicCourse TopicCourse[]
}

model CourseMaterial {
  courseMaterialId String @id @default(uuid())
  url String
  course Course @relation(fields: [courseId], references: [courseId])
  courseId String
}

model Transaction {
  transactionId String @id @default(uuid())
  amountPaid Float
  status Status
  createdOn DateTime @default(now())
  student Student @relation(fields: [studentId], references: [studentId])
  studentId String
  course Course @relation(fields: [courseId], references: [courseId])
  courseId String
}

model Topics {
  topicId String @id @default(uuid())
  topicName String
  description String
  url String
  topicCourse TopicCourse[]
}

model TopicCourse{
  topicCourseId String @id @default(uuid())
  course Course @relation(fields: [courseId], references: [courseId])
  courseId String
  topics Topics @relation(fields: [topicId], references: [topicId])
  topicId String
  @@unique([courseId, topicId])


}

model RefreshTokens {
  rTokenId String @id @default(uuid())
  token String @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expiredAt DateTime
  user User @relation(fields: [userId], references: [userId])
  userId String  
}

model OtpToken {
  oTokenId String @id @default(uuid())
  token String @db.VarChar(6)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expiredAt DateTime
  user User @relation(fields: [userId], references: [userId])
  userId String   @unique 
}

model EmailToken {
  eTokenId String @id @default(uuid())
  token String @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  expiredAt DateTime
  user User @relation(fields: [userId], references: [userId])
  userId String   @unique 
}

enum Role {
  User
  Student
  Instructor
  Moderator
  Employees
}

enum Language {
  Chinese
  English
  French
  Indian
  Japanese
  Korean
  Malay
}

enum Status {
  InProgress
  Pending
  Completed
  Approved
  Ongoing
  Started
}